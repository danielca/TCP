<!DOCTYPE html>
<html>

<!-- 
 ABOVE web viewer 0.2.1
 Created by: Casey Daniel
 Date: 15 Oct 2014
 This page is designed to be insterted into the ABOVE webpage and serve as a summary plot viewer.

 This is a W.I.P.

 Change Log:
    0.0.1:
        -N/A

    0.1.1:
        -Added in an onError method. If a picture can't load, it will look through the remaining day to check for more plots
        -Made the ftp server IP a constant

    0.1.2:
        -onError now accounts for the direction you were trying to go


    0.2.0:
        -Page now searches for one hour before defaulting to an availability plot
        -can now check and scroll through availability plots
        -fixed back button search
        -Go button works properly now

    0.2.1:
        -Updated fort smith name
 -->

<head>
<style type="text/css">
body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}
span label {
    display: block;
    position: relative;
    top:2.7em;
    text-align: center;
}

</style>
</head>


<body>

    <section>
        <!-- Form for selecting a plot-->
        <form id = "Selection_form">
            <label for="year">Year: </label><select id="year">
                <option value = "">-  Year  -</option>
                <option value = "2014">2014</option>
            </select>
            <label for="month"> Month: </label><select id = "month">
                <option value = "">-  Month  -</option>
                <option value = "01">January</option>
                <option value = "02">Febuary</option>
                <option value = "03">March</option>
                <option value = "04">April</option>
                <option value = "05">May</option>
                <option value = "06">June</option>
                <option value = "07">July</option>
                <option value = "08">August</option>
                <option value = "09">September</option>
                <option value = "10">October</option>
                <option value = "11">November</option>
                <option value = "12">December</option>
            </select>
            <label for="day"> Day: </label><select id = "day">
                <option value = "">-  Day  -</option>
                <option value = "01">1</option>
                <option value = "02">2</option>
                <option value = "03">3</option>
                <option value = "04">4</option>
                <option value = "05">5</option>
                <option value = "06">6</option>
                <option value = "07">7</option>
                <option value = "08">8</option>
                <option value = "09">9</option>
                <option value = "10">10</option>
                <option value = "11">11</option>
                <option value = "12">12</option>
                <option value = "13">13</option>
                <option value = "14">14</option>
                <option value = "15">15</option>
                <option value = "16">16</option>
                <option value = "17">17</option>
                <option value = "18">18</option>
                <option value = "19">19</option>
                <option value = "20">20</option>
                <option value = "21">21</option>
                <option value = "22">22</option>
                <option value = "23">23</option>
                <option value = "24">24</option>
                <option value = "25">25</option>
                <option value = "26">26</option>
                <option value = "27">27</option>
                <option value = "28">28</option>
                <option value = "29">29</option>
                <option value = "30">30</option>
                <option value = "31">31</option>
            </select>
            <label for="hour"> Hour: </label><select id = "hour">
                <option value = "">-  Hour  -</option>
                <option value = "00">00</option>
                <option value = "01">01</option>
                <option value = "02">02</option>
                <option value = "03">03</option>
                <option value = "04">04</option>
                <option value = "05">05</option>
                <option value = "06">06</option>
                <option value = "07">07</option>
                <option value = "08">08</option>
                <option value = "09">09</option>
                <option value = "10">10</option>
                <option value = "11">11</option>
                <option value = "12">12</option>
                <option value = "13">13</option>
                <option value = "14">14</option>
                <option value = "15">15</option>
                <option value = "16">16</option>
                <option value = "17">17</option>
                <option value = "18">18</option>
                <option value = "19">19</option>
                <option value = "20">20</option>
                <option value = "21">21</option>
                <option value = "22">22</option>
                <option value = "23">23</option>
            </select>
            <label for="min"> Minute: </label><select id = "min">
                <option value = "">-  Minute  -</option>
                <option value = "00">0</option>
                <option value = "01">1</option>
                <option value = "02">2</option>
                <option value = "03">3</option>
                <option value = "04">4</option>
                <option value = "05">5</option>
                <option value = "06">6</option>
                <option value = "07">7</option>
                <option value = "08">8</option>
                <option value = "09">9</option>
                <option value = "10">10</option>
                <option value = "11">11</option>
                <option value = "12">12</option>
                <option value = "13">13</option>
                <option value = "14">14</option>
                <option value = "15">15</option>
                <option value = "16">16</option>
                <option value = "17">17</option>
                <option value = "18">18</option>
                <option value = "19">19</option>
                <option value = "20">20</option>
                <option value = "21">21</option>
                <option value = "22">22</option>
                <option value = "23">23</option>
                <option value = "24">24</option>
                <option value = "25">25</option>
                <option value = "26">26</option>
                <option value = "27">27</option>
                <option value = "28">28</option>
                <option value = "29">29</option>
                <option value = "30">30</option>
                <option value = "31">31</option>
                <option value = "32">32</option>
                <option value = "33">33</option>
                <option value = "34">34</option>
                <option value = "35">35</option>
                <option value = "36">36</option>
                <option value = "37">37</option>
                <option value = "38">38</option>
                <option value = "39">39</option>
                <option value = "40">40</option>
                <option value = "41">41</option>
                <option value = "42">42</option>
                <option value = "43">43</option>
                <option value = "44">44</option>
                <option value = "45">45</option>
                <option value = "46">46</option>
                <option value = "47">47</option>
                <option value = "48">48</option>
                <option value = "49">49</option>
                <option value = "50">50</option>
                <option value = "51">51</option>
                <option value = "52">52</option>
                <option value = "53">53</option>
                <option value = "54">54</option>
                <option value = "55">55</option>
                <option value = "56">56</option>
                <option value = "57">57</option>
                <option value = "58">58</option>
                <option value = "59">59</option>
            </select>
            <label for="site"> Select Site: </label><select id = "site">
                <option value = "">-   site   -</option>
                <option value = "barr_vlf-01">Barrier Lake</option>
                <option value = "cmrs_vlf-02">Camrose</option>
                <option value = "atha_vlf-03">Athabasca</option>
                <option value = "pina_vlf-04">Pinawa</option>
                <option value = "fsmi_vlf-05">Fort Smith</option>
            </select>

            <button id = "Go"> GO! </button>
            <button id = "Back"> <<< </button>
            <button id = "Forward"> >>> </button>
            <button id = "availCheck">Check Availability</button>
            <button id = "prevAvail">Previous Month's Availability</button>
            <button id = "nextAvail">Next Month's Availability</button>
        </form>
    </section>
    <section>

    <!-- Image -->

	<IMG id = "Plot" SRC="" height = "1200" width = "840" onerror = "onError()">
    </section>

	<!-- Javascript will be here -->
	<script type="text/Javascript">
	// Intialize variables
	var Year;
	var Month;
	var Day;
	var Hour;
	var Site;
	var Min;
	var FTPString;
    var IPAddr = "136.159.51.230:21";
    var Direction = 1;
    var minChecked = 0;
    var availPlot = false;


	function get_plot() {
	    event.preventDefault();
        availPlot = false;
        var minChecked = 0;
	    Year = document.getElementById("year").value;
	    Month = document.getElementById("month").value;
	    Day = document.getElementById("day").value;
	    Hour = document.getElementById("hour").value;
	    Min = document.getElementById("min").value;
	    Site = document.getElementById("site").value;

	    // Check to make sure all values are entered
	    if (Year === '' || Month === '' || Day === '' || Hour === '' || Site === '' || Min === '') {
	        alert("Please ensure all values are values are entered");
	    }

	    FTPString = "ftp://Anonymous@" + IPAddr +"/" + Year + "/" + Month + "/" + Day + "/" + Site.substr(0,4) + "/" + Hour + "/" + Year + Month + Day + "_" + Hour + Min + "_" + Site + "_summary_plot.png";
        document.getElementById("Plot").src = FTPString;
	}
	
	function next_plot_one() {
	    event.preventDefault();
        availPlot = false;
        var minChecked = 0;
	    Year = document.getElementById("year").value;
	    Month = document.getElementById("month").value - 1;
	    Day = document.getElementById("day").value;
	    Hour = document.getElementById("hour").value;
	    Min = document.getElementById("min").value;
	    Site = document.getElementById("site").value;

        //Reset the direction incase of an error
        Direction = 1;

	    // Check to make sure all values are entered
	    if (Year === '' || Month === '' || Day === '' || Hour === '' || Site === '' || Min === '') {
	        alert("Please ensure all values are values are entered");
	    }
	    //Convert to a date object and add the incremented time
	    var newDate = new Date(Date.UTC(Year, Month, Day, Hour, Min));
	    //var newDate = new Date(date.getTime() + (incrementBy * 60000));
	    newDate.setTime(newDate.getTime() + (60*1000));
	    var dateString = newDate.toISOString();

	    //set the new time
	    //Note the whole getDate and other related methods are acting oddly and it's far more reliable to just use the string. -.-
	    document.getElementById("year").value = dateString.substr(0,4);
	    document.getElementById("month").value = dateString.substr(5,2);
	    document.getElementById("day").value = dateString.substr(8,2);
	    document.getElementById("hour").value = dateString.substr(11,2);
	    document.getElementById("min").value = dateString.substr(14,2);


        Year = dateString.substr(0,4);
        Month = dateString.substr(5,2);
        Day = dateString.substr(8,2);
        Hour = dateString.substr(11,2);
        Min = dateString.substr(14,2);

        Month = "0" + Month;
        Month = Month.slice(-2);

	    FTPString = "ftp://Anonymous@" + IPAddr +"/" + Year + "/" + Month + "/" + Day + "/" + Site.substr(0,4) + "/" + Hour + "/" + Year + Month + Day + "_" + Hour + Min + "_" + Site + "_summary_plot.png";
	    document.getElementById("Plot").src = FTPString;

	}

	function previous_plot_one() {
	    event.preventDefault();
        availPlot = false;
        var minChecked = 0;
		Year = document.getElementById("year").value;
	    Month = document.getElementById("month").value - 1;
	    Day = document.getElementById("day").value;
	    Hour = document.getElementById("hour").value;
	    Min = document.getElementById("min").value;
	    Site = document.getElementById("site").value;

        //Reset the direction incase of no plot found

        Direction = -1;

	    // Check to make sure all values are entered
	    if (Year === '' || Month === '' || Day === '' || Hour === '' || Site === '' || Min === '') {
	        alert("Please ensure all values are values are entered");
	    }	   


	    //Convert to a date object and add the incremented time
	    var newDate = new Date(Date.UTC(Year, Month, Day, Hour, Min));
	    //var newDate = new Date(date.getTime() + (incrementBy * 60000));
	    newDate.setTime(newDate.getTime() - (60*1000));
	    var dateString = newDate.toISOString();

	    //set the new time
	    //Note the whole getDate and other related things are weired and it's far more reliable to just use the string. -.-
	    document.getElementById("year").value = dateString.substr(0,4);
	    document.getElementById("month").value = dateString.substr(5,2);
	    document.getElementById("day").value = dateString.substr(8,2);
	    document.getElementById("hour").value = dateString.substr(11,2);
	    document.getElementById("min").value = dateString.substr(14,2);

        Year = dateString.substr(0,4);
        Month = dateString.substr(5,2);
        Day = dateString.substr(8,2);
        Hour = dateString.substr(11,2);
        Min = dateString.substr(14,2);



        Month = "0" + Month;
        Month = Month.slice(-2);

	    FTPString = "ftp://Anonymous@" + IPAddr +"/" + Year + "/" + Month + "/" + Day + "/" + Site.substr(0,4) + "/" + Hour + "/" + Year + Month + Day + "_" + Hour + Min + "_" + Site + "_summary_plot.png";
	    document.getElementById("Plot").src = FTPString;
	}

    function onError() {
        event.preventDefault();
        minChecked += 1;
        // get the currect selection
        Year = document.getElementById("year").value;
	    Month = document.getElementById("month").value -1;
	    Day = document.getElementById("day").value;
	    Hour = document.getElementById("hour").value;
	    Min = document.getElementById("min").value;
	    Site = document.getElementById("site").value;

        //Check for blank feilds
        if (Year === '' || Month === '' || Day === '' || Hour === '' || Site === '' || Min === '') {
	    //    alert("Unknown Error, please try entering the information again");

	        return;
        }

        //check to see if the an attempt was made at finding the availability chart
        if (availPlot) {
            alert("Unable to find data or the availability chart, Please try again later");
            return;
        }
        //Check to see if an hour has been searched
        if (minChecked > 59) {
            availPlot = true;
            Month += 1;
            Month = "0" + Month;
            Month = Month.slice(-2);
            FTPString = "ftp://Anonymous@" + IPAddr +"/" + Year + "/" + Month + "/" + Year + "-" + Month + "-availability.png";
            document.getElementById("Plot").src = FTPString;
            alert("Unable to find data, please refer to the availability chart");
            return;
        }

        var currentDate = new Date();
	    //Convert to a date object and add the incremented time
	    var newDate = new Date(Date.UTC(Year, Month, Day, Hour, Min));
	    newDate.setTime(newDate.getTime() + (60000*Direction));
	    var dateString = newDate.toISOString();

        //set the new time
	    //Note the whole getDate and other related things are weired and it's far more reliable to just use the string. -.-
	    document.getElementById("year").value = dateString.substr(0,4);
	    document.getElementById("month").value = dateString.substr(5,2);
	    document.getElementById("day").value = dateString.substr(8,2);
	    document.getElementById("hour").value = dateString.substr(11,2);
	    document.getElementById("min").value = dateString.substr(14,2);

        // Check to see if the time is from the future. (Sorry no time travelers)
        if (currentDate < newDate) {
            alert("There is no new data to display, please make another selection");
            return;
        }



        Year = dateString.substr(0,4);
        Month = dateString.substr(5,2);
        Day = dateString.substr(8,2);
        Hour = dateString.substr(11,2);
        Min = dateString.substr(14,2);

        Month = "0" + Month;
        Month = Month.slice(-2);

	    FTPString = "ftp://Anonymous@" + IPAddr +"/" + Year + "/" + Month + "/" + Day + "/" + Site.substr(0,4) + "/" + Hour + "/" + Year + Month + Day + "_" + Hour + Min + "_" + Site + "_summary_plot.png";
	    document.getElementById("Plot").src = FTPString;

    }

    //Function to reset the counter when the image is loaded
    function imageLoaded() {
        minChecked = 0;
        availPlot = false;

    }

    function checkAvail(){
        event.preventDefault();
        Year = document.getElementById("year").value;
        Month = document.getElementById("month").value;
        availPlot = true;
        FTPString = "ftp://Anonymous@" + IPAddr +"/" + Year + "/" + Month + "/" + Year + "-" + Month + "-availability.png";
        document.getElementById("Plot").src = FTPString;

    }

    function prevAvailCheck() {
        event.preventDefault();
        Year = document.getElementById("year").value;
        Month = document.getElementById("month").value;
        availPlot = true;

        if (Month == '01') {
            Year = String(parseInt(Year, 10) - 1);
            Month = '12'
        } else {
            Month = String(parseInt(Month, 10) -1);
            Month = '0' + Month;
            Month = Month.slice(-2);
        }

        document.getElementById("year").value = Year;
        document.getElementById("month").value = Month;

        FTPString = "ftp://Anonymous@" + IPAddr +"/" + Year + "/" + Month + "/" + Year + "-" + Month + "-availability.png";
        document.getElementById("Plot").src = FTPString;

    }

    function nextAvailCheck() {
        event.preventDefault();
        Year = document.getElementById("year").value;
        Month = document.getElementById("month").value;
        availPlot = true;

        if (Month == '12') {
            Year = String(parseInt(Year, 10) + 1);
            Month = '01'
        } else {
            Month = String(parseInt(Month, 10) + 1);
            Month = '0' + Month;
            Month = Month.slice(-2);
        }

        document.getElementById("year").value = Year;
        document.getElementById("month").value = Month;

        FTPString = "ftp://Anonymous@" + IPAddr +"/" + Year + "/" + Month + "/" + Year + "-" + Month + "-availability.png";
        document.getElementById("Plot").src = FTPString;

    }

    //Add listners for all the buttons. There are a number of buttons.... Also an onload for the plot to reset counters
    var goButton = document.getElementById("Go");
    if (goButton.addEventListener)
        goButton.addEventListener("click", get_plot, false);
    else if (goButton.attachEvent)
        goButton.attachEvent("onClick", get_plot);

	var forwardButton = document.getElementById("Forward");
	if (forwardButton.addEventListener)
		forwardButton.addEventListener("click", next_plot_one, false);
	else if (forwardButton.attachEvent)
		forwardButton.attachEvent('onClick', next_plot_one);

	var BackButton = document.getElementById("Back");
	if (BackButton.addEventListener)
		BackButton.addEventListener("click", previous_plot_one, false);
	else if (BackButton.attachEvent)
		forwardButton.attachEvent('onClick', previous_plot_one);

    var imageCheck = document.getElementById("Plot");
    if (imageCheck.addEventListener)
        imageCheck.addEventListener('load', imageLoaded, false);
    else if (imageCheck.attachEvent)
        imageCheck.attachEvent('onLoad', imageLoaded);

    var availCheck = document.getElementById("availCheck");
    if (availCheck.addEventListener) {
        availCheck.addEventListener("click", checkAvail, false);
    } else if (availCheck.attachEvent) {
        availCheck.attachEvent("onClick", checkAvail);
    }

    var nextAvail = document.getElementById("nextAvail");
    if (nextAvail.addEventListener) {
        nextAvail.addEventListener("click", nextAvailCheck, false);
    } else if (nextAvail.attachEvent) {
        nextAvail.attachEvent("onClick", nextAvailCheck);
    }

    var prevAvail = document.getElementById("prevAvail");
    if (prevAvail.addEventListener) {
        prevAvail.addEventListener("click", prevAvailCheck, false);
    } else if (prevAvail.attachEvent) {
        prevAvail.addEventListener("onClick", prevAvailCheck);
    }


	</script>
	
	
</body>
</html>